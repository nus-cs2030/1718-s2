



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://nus-cs2030.github.io/1718-s2/lec06/index.html">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.1">
    
    
      
        <title>6. hashCode, Nested Class, enum - CS2030 Programming Methodology II</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.aa3de92b.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    
  </head>
  
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#lecture-6-hash-code-nested-classes-enum" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://nus-cs2030.github.io/1718-s2" title="CS2030 Programming Methodology II" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                CS2030 Programming Methodology II
              </span>
              <span class="md-header-nav__topic">
                6. hashCode, Nested Class, enum
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/nus-cs2030/1718-s2/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    CS2030 Programming Methodology II
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/nus-cs2030/1718-s2/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      General
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/index.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prereqs/index.html" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../policies/index.html" title="Policies" class="md-nav__link">
      Policies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../schedule/index.html" title="Schedule" class="md-nav__link">
      Schedule
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../readings/index.html" title="Readings" class="md-nav__link">
      Readings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../midterm/index.html" title="Midterm" class="md-nav__link">
      Midterm
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lab0/index.html" title="0. Warm Up" class="md-nav__link">
      0. Warm Up
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1a/index.html" title="1a. Simulator v1.0" class="md-nav__link">
      1a. Simulator v1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1b/index.html" title="1b. Simulator v1.1" class="md-nav__link">
      1b. Simulator v1.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2a/index.html" title="2a. Simulator v1.2" class="md-nav__link">
      2a. Simulator v1.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2b/index.html" title="2b. Simulator v1.3" class="md-nav__link">
      2b. Simulator v1.3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab3/index.html" title="3.  Infinite List" class="md-nav__link">
      3.  Infinite List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab4a/index.html" title="4a. Simulator v2.0" class="md-nav__link">
      4a. Simulator v2.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Lectures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Lectures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lec01/index.html" title="1. Abstraction & Encapsulation" class="md-nav__link">
      1. Abstraction & Encapsulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec02/index.html" title="2. Interface, Inheritance & Polymorphism" class="md-nav__link">
      2. Interface, Inheritance & Polymorphism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec03/index.html" title="3. More on Inheritance" class="md-nav__link">
      3. More on Inheritance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec04/index.html" title="4. Types, Memory, Exception" class="md-nav__link">
      4. Types, Memory, Exception
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec05/index.html" title="5. Generics and Collections" class="md-nav__link">
      5. Generics and Collections
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        6. hashCode, Nested Class, enum
      </label>
    
    <a href="index.html" title="6. hashCode, Nested Class, enum" class="md-nav__link md-nav__link--active">
      6. hashCode, Nested Class, enum
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" title="Learning Outcomes" class="md-nav__link">
    Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-hash-code" title="1. Hash Code" class="md-nav__link">
    1. Hash Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-nested-class" title="2. Nested Class" class="md-nav__link">
    2. Nested Class
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-class" title="Local Class" class="md-nav__link">
    Local Class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-capture" title="Variable Capture" class="md-nav__link">
    Variable Capture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectively-final" title="Effectively final" class="md-nav__link">
    Effectively final
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anonymous-class" title="Anonymous Class" class="md-nav__link">
    Anonymous Class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-enum" title="3. Enum" class="md-nav__link">
    3. Enum
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enums-fields-and-methods" title="Enum's Fields and Methods" class="md-nav__link">
    Enum's Fields and Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-methods-for-each-enum" title="Custom Methods for Each Enum" class="md-nav__link">
    Custom Methods for Each Enum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-class-enum" title="The Class Enum" class="md-nav__link">
    The Class Enum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum-related-collections" title="Enum-related Collections" class="md-nav__link">
    Enum-related Collections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise" title="Exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec07/index.html" title="7. Functions" class="md-nav__link">
      7. Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec08/index.html" title="8. Streams" class="md-nav__link">
      8. Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec09/index.html" title="9. FP Patterns" class="md-nav__link">
      9. FP Patterns
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec10/index.html" title="10. Parallel streams" class="md-nav__link">
      10. Parallel streams
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../style/index.html" title="Coding Style" class="md-nav__link">
      Coding Style
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Software/Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Software/Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../jdk/index.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../javadoc/index.html" title="Javadoc" class="md-nav__link">
      Javadoc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unix/index.html" title="UNIX" class="md-nav__link">
      UNIX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim/index.html" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" title="Learning Outcomes" class="md-nav__link">
    Learning Outcomes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-hash-code" title="1. Hash Code" class="md-nav__link">
    1. Hash Code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-nested-class" title="2. Nested Class" class="md-nav__link">
    2. Nested Class
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-class" title="Local Class" class="md-nav__link">
    Local Class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-capture" title="Variable Capture" class="md-nav__link">
    Variable Capture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effectively-final" title="Effectively final" class="md-nav__link">
    Effectively final
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anonymous-class" title="Anonymous Class" class="md-nav__link">
    Anonymous Class
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-enum" title="3. Enum" class="md-nav__link">
    3. Enum
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enums-fields-and-methods" title="Enum's Fields and Methods" class="md-nav__link">
    Enum's Fields and Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-methods-for-each-enum" title="Custom Methods for Each Enum" class="md-nav__link">
    Custom Methods for Each Enum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-class-enum" title="The Class Enum" class="md-nav__link">
    The Class Enum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enum-related-collections" title="Enum-related Collections" class="md-nav__link">
    Enum-related Collections
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise" title="Exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nus-cs2030/1718-s2/edit/master/docs/lec06.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lecture-6-hash-code-nested-classes-enum">Lecture 6: Hash Code, Nested Classes, Enum</h1>
<h2 id="learning-outcomes">Learning Outcomes</h2>
<ul>
<li>Understand the need to override <code class="codehilite">hashCode</code> whenever <code class="codehilite">equals</code> is overridden and how to use <code class="codehilite">Arrays</code>' <code class="codehilite">hashCode</code> method to compute a hash code</li>
<li>Understand static vs. non-static nested class, local class, and anonymous class and when to use / not to use one</li>
<li>Understand the rules about final / effectively final variable access for local class and anonymous class</li>
<li>Aware of the limitation when declaring a new anonymous class</li>
<li>Understand the concept of variable capture</li>
<li>Be aware that <code class="codehilite"><span class="k">enum</span></code> is a special case of a <code class="codehilite"><span class="k">class</span></code> and share many features as a class -- not just constants can be defined.</li>
<li>Understand how <code class="codehilite"><span class="k">enum</span></code> is expanded into a subclass of <code class="codehilite">Enum</code></li>
<li>Know that enum constants can have customized fields and methods.</li>
</ul>
<h2 id="1-hash-code">1. Hash Code</h2>
<p>We have seen how <code class="codehilite">HashMap</code> in Java Collections allows us to store a key-value pair and lookup a value with the key, and how <code class="codehilite">HashSet</code> stores item with no duplicates. </p>
<p>Internally, <code class="codehilite">HashMap</code> and <code class="codehilite">HashSet</code> organize the items into "buckets".  Such organization improves efficiency if we need to search through the items, either to find a pair with a given key, or to check if an item already exists in the set.  We no longer need to search through the entire collection, but only the "bucket" that the item, if exists, would have been organized into.  For this idea to work, each item must be <em>hashed</em> deterministically into a bucket. </p>
<p>In Java objects, such hashing operation is determined by the method <code class="codehilite">hashCode()</code> of a given key object.  <code class="codehilite">hashCode()</code> returns an <code class="codehilite">int</code>, which <code class="codehilite">HashMap</code>, <code class="codehilite">HashSet</code>, or other data structures can use to determine which "bucket" to store a (key, value) pair or an item into.</p>
<p>You will learn more about hashing and hash tables in CS2040.</p>
<p>But, what is important here is that two keys (two objects, in general) which are the same (<code class="codehilite">equals()</code> returns <code class="codehilite">true</code>), must have the same <code class="codehilite">hashCode()</code>.  Otherwise, <code class="codehilite">HashMap</code> would fail.</p>
<p>So it is important to ensure that if <code class="codehilite">o1.equals(o2)</code>, then <code class="codehilite">o1.hashCode() == o2.hashCode()</code>.  Note that the reverse does not have to be true -- two objects with the same hash code does not have to be equals.</p>
<p>This property is also useful for implementing <code class="codehilite">equals()</code>.  For a complex object, comparing every field for equality can be expensive.  If we can compare the hash code first, we could filter out objects with different hash code (since they cannot be equal).  We only need to compare field by field if the hash code is the same.</p>
<p>Let's see some example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span><span class="o">;</span>
<span class="n">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">s3</span> <span class="o">=</span> <span class="s">&quot;goodbye&quot;</span><span class="o">;</span>
<span class="n">s1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
<span class="n">s2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
<span class="n">s3</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</pre></div>
</td></tr></table>

<p>Lines 4-5 both return 99162326, an integer value that is calculated using a mathematical function, called <em>hash function</em>, so that two strings with the same content returns the same value.  Line 6 returns 207022353.</p>
<p>We can see the problem when we don't define <code class="codehilite">hashCode()</code>.  Take our <code class="codehilite">Point</code> class from before:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">jshell</span><span class="o">&gt;</span> <span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
<span class="n">p</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span><span class="mf">0.0</span><span class="o">)</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">Point</span> <span class="n">q</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
<span class="n">q</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span><span class="mf">0.0</span><span class="o">)</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
<span class="n">$5</span> <span class="o">==&gt;</span> <span class="kc">true</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
<span class="n">set</span> <span class="o">==&gt;</span> <span class="o">[]</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
<span class="n">$7</span> <span class="o">==&gt;</span> <span class="kc">true</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">set</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">q</span><span class="o">);</span>
<span class="n">$8</span> <span class="o">==&gt;</span> <span class="kc">true</span>

<span class="n">jshell</span><span class="o">&gt;</span> <span class="n">set</span>
<span class="n">set</span> <span class="o">==&gt;</span> <span class="o">[(</span><span class="mf">0.0</span><span class="o">,</span><span class="mf">0.0</span><span class="o">),</span> <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span><span class="mf">0.0</span><span class="o">)]</span>
</pre></div>
</td></tr></table>

<p>You can see that we have added two points that are the same into the set, which usually is not what we want.  To fix this, we need to write our own <code class="codehilite">hashCode()</code>, by overriding the <code class="codehilite">hashCode()</code> method in the <code class="codehilite">Object</code> class.</p>
<p>Calculating good hash code is an involved topic, and is beyond the scope of CS2030.  In Java, the utility class <code class="codehilite">Arrays</code> provide us some convenient <code class="codehilite">hashCode</code> methods to help us.  We can pack the fields of a class into an array, and then call <code class="codehilite">Arrays.hashCode()</code> to compute the hash code of these fields.  Let's add the following to <code class="codehilite">Point</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="o">:</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">double</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    <span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>
    <span class="n">a</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Now, <code class="codehilite">set.add(q)</code> above returns false -- we can no longer add point (0,0) twice in to the set.</p>
<div class="admonition note">
<p class="admonition-title">XOR-ing hash codes</p>
<p>If you have fields in a class that are of different types (and cannot be packed into a single array), you can pack them into different arrays, call <code class="codehilite">Arrays.hashCode()</code> for each of the arrays, and combine the hash code together with the XOR operator <code class="codehilite">^</code>.  XOR is mathematically a good operator for combining two hash codes, since given two numbers with equal distribution of 0s and 1s, XOR-ing them will give another number with equal distribution of 0s and 1s.</p>
</div>
<h2 id="2-nested-class">2. Nested Class</h2>
<p>The second topic for today is nested class.  There are four kinds of nested classes in Java.  You have seen a static nested class, used inappropriately in <a href="../lab1a/index.html">Lab 1a</a>.  Let's see where are some good use cases to use nested classes.</p>
<p>Nested classes are used to group logically relevant classes together.  Typically, a nested class is tightly coupled with the container class, and would have no use outside of the container class.  Nested classes can be used to encapsulate information within a container class, for instance, when implementation of a class becomes too complex.  As such, it is useful for "helper" classes that serve specific purposes.</p>
<p>A nested class is a field of the containing class, and can access fields and methods of the containing class, including those declared as <code class="codehilite">private</code>.  We can keep the nested class within the abstraction barrier, and declare a nested class as <code class="codehilite">private</code>, if there is no need for it to be exposed to the client outside the barrier.
On the other hand, because of this, you should really have a nested class only if the nested class belongs to the same encapsulation.  Otherwise, the containing class would leak its implementation details to the nested class. </p>
<p>Take the <code class="codehilite">HashMap&lt;K,V&gt;</code> class for instance.  <a href="https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/util/HashMap.java">The implementation of <code class="codehilite">HashMap&lt;K,V&gt;</code></a> contains several nested classes, including <code class="codehilite">HashIterator</code>, which implement an <code class="codehilite">Iterator&lt;E&gt;</code> interface for iterating through the key and value pairs in the map, and an <code class="codehilite">Entry&lt;K,V&gt;</code> class, which encapsulates a key-value pair in the map.  Some of these classes are declared <code class="codehilite">private</code>, if they are only used within the <code class="codehilite">HashMap&lt;K,V&gt;</code> class.</p>
<p>A nested class can be either static or non-static.  Just like static fields and static methods, a <em>static nested class</em> is associated with the containing <em>class</em>, NOT an <em>instance</em>.  So, it can only access static fields and static methods of the containing class.  A <em>non-static nested class</em>, on the other hand, can access all fields and methods of the containing class.  A <em>non-static nested class</em> is also known as an <em>inner class</em>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
  <span class="kd">static</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>

  <span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// accessing x from A is OK</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">bar</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// accessing x from A is not OK since C is static</span>
      <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// accessing y is OK</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h3 id="local-class">Local Class</h3>
<p>We can also declare a class within a function as well, just like a local variable.  One example is the <code class="codehilite">NameComparator</code> class in <a href="../lec05/index.html">Lecture 5</a>.  In that example, we created another top-level class (and so, a new file) just to define how to compare two strings, which is a little bit silly.</p>
<p>We can actually just define the <code class="codehilite">NameComparator</code> class when we need it, just before we sort:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">sortNames</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">)</span> <span class="o">{</span>

  <span class="kd">class</span> <span class="nc">NameComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">names</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="n">NameComparator</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>This makes the code easier to read since we keep the definition of the class and its usage closer together. </p>
<p>Classes like <code class="codehilite">NameComparator</code> that are declared inside a method (to be more precise, inside a block of code between <code class="codehilite">{</code> and <code class="codehilite">}</code>) is called a <em>local class</em>.  Just like a local variable, a local class is scoped within the method.  Like a nested class, a local class has access to the variables of the enclosing class.  Further, it can access the variables of the local variables of the enclosing method.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
      <span class="kt">void</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="c1">// accessing x and y is OK.</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">new</span> <span class="n">B</span><span class="o">().</span><span class="na">g</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<h3 id="variable-capture">Variable Capture</h3>
<p>Recall that when a method returns, all local variables of the methods are removed from the stack.  But, an instance of that local class might still exist.  Consider the following example:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">C</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">g</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

  <span class="n">C</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="kd">class</span> <span class="nc">B</span> <span class="kd">implements</span> <span class="n">C</span> <span class="o">{</span>
      <span class="kt">void</span> <span class="nf">g</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="c1">// accessing x and y is OK.</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">B</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Calling 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
<span class="n">C</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">f</span><span class="o">();</span>
<span class="n">b</span><span class="o">.</span><span class="na">g</span><span class="o">();</span>
</pre></div>
</td></tr></table></p>
<p>will give us a reference to an object of type <code class="codehilite">B</code> now.  But, if we call <code class="codehilite">b.g()</code>, what is the value of <code class="codehilite">y</code>? </p>
<p>For this reason, even though a local class can access the local variables in the enclosing method, the local class makes <em>a copy of local variables</em> inside itself.  We say that a local class <em>captures</em> the local variables.   </p>
<h3 id="effectively-final">Effectively <code class="codehilite">final</code></h3>
<p>Variable captures could be confusing.  Consider the following code:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">sortNames</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">names</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="n">ascendingOrder</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kd">class</span> <span class="nc">NameComparator</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">ascendingOrder</span><span class="o">)</span> 
        <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
      <span class="k">else</span> 
        <span class="k">return</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="n">ascendingOrder</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  <span class="n">names</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="n">NameComparator</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Will <code class="codehilite">sort</code> sorts in ascending order or descending order?</p>
<p>To avoid confusing code like this, Java only allows a local class to access variables that are explicitly declared <code class="codehilite">final</code> or implicitly final (or <em>effectively</em> final).  An implicitly final variable is one that does not change after initialization.  Therefore, Java saves us from such hair-pulling situation and disallow such code -- <code class="codehilite">ascendingOrder</code> is not effectively final so the code above does not compile.</p>
<div class="admonition note">
<p class="admonition-title">Variable Capture in Javascript</p>
<p>Those of you who did CS1101S or otherwise familiar with Javascript might want to note that this is different from Javascript, which does not enforce the final/effectively final restriction in variable captures.</p>
</div>
<p>I do not see a good use case for local class -- if you have information and behavior inside a block of code that is so complex that you need to encapsulate it within a local class, it is time to rethink your design.</p>
<p>What about the use case of <code class="codehilite">NameComparator</code> above?  There are actually better ways to write the class.  We will look at <em>anonymous class</em> today.</p>
<h3 id="anonymous-class">Anonymous Class</h3>
<p>An anonymous class is one where you declare a class and instantiate it in a single statement.  It's anonymous since We do not even have to give the class a name.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">names</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</td></tr></table></p>
<p>The example above removes the need to declare a class just for the purpose of comparing two strings.  </p>
<p>An anonymous class has the following format: <code class="codehilite">new X (arguments) { body }</code>, where:</p>
<ul>
<li><em>X</em> is a class that the anonymous class extends or an interface that the anonymous class implements.  X cannot be empty.  This syntax also implies an anonymous class cannot extend another class and implement an interface at the same time.  Furthermore, an anonymous class cannot implement more than one interface. </li>
<li><em>arguments</em> are the arguments that you want to pass into the constructor of the anonymous class.  If the anonymous class is extending an interface, then there is no constructor, but we still need <code class="codehilite">()</code>.</li>
<li><em>body</em> is the body of the class as per normal, except that we cannot have a constructor for an anonymous class.</li>
</ul>
<p>The syntax might look overwhelming at the beginning, but we can also write it as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">cmp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">String</span> <span class="n">s1</span><span class="o">,</span> <span class="n">String</span> <span class="n">s2</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">};</span>
<span class="n">names</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">cmp</span><span class="o">);</span>
</pre></div>
</td></tr></table>

<p>Line 1 above looks just like what we do when we instantiate a class, except that we are instantiating an interface with a <code class="codehilite">{ .. }</code> body.</p>
<p>An anonymous class is just like a local class, it captures the variables of the enclosing scope as well -- the same rules to variable access as local class applies.</p>
<h2 id="3-enum">3. Enum</h2>
<p>An <code class="codehilite"><span class="k">enum</span></code> is a special type of class in Java.  Variable of an enum type can only be one of the predefined constants.  Using enum has one advantage over the use of <code class="codehilite">int</code> for predefined constant -- it is type safe.  Consider how we have been defining different event types in <a href="../lab1a/index.html">Lab 1a</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">CUSTOMER_ARRIVE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">CUSTOMER_DONE</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
</pre></div>
</td></tr></table>

<p>But, we cannot prevent someone from creating an event <code class="codehilite">new Event(time, 100)</code>, passing in an invalid event type (type 100).  </p>
<p>If we define the event type as enum, then we can write like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">enum</span> <span class="n">EventType</span> <span class="o">{</span>
  <span class="n">CUSTOMER_ARRIVE</span><span class="o">,</span> 
  <span class="n">CUSTOMER_DONE</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>and the field <code class="codehilite">eventType</code> in <code class="codehilite">Event</code> now has a type <code class="codehilite">EventType</code> instead of <code class="codehilite">int</code>:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">time</span><span class="o">;</span> 
  <span class="kd">private</span> <span class="n">EventType</span> <span class="n">eventType</span><span class="o">;</span> 
<span class="o">}</span>
</pre></div>
</td></tr></table></p>
<p>Trying to assign anything other than the two predefined event type to <code class="codehilite">eventType</code> would result in compilation error.  Remember, an error caught at compile time is much better than an error caught during run time, so this is good!</p>
<div class="admonition note">
<p class="admonition-title">In other languages</p>
<p>Enumerated types like <code class="codehilite"><span class="k">enum</span></code> are common in other langauges, including procedural languages like C.  But, <code class="codehilite"><span class="k">enum</span></code> in Java is more powerful, as seen below.</p>
</div>
<h3 id="enums-fields-and-methods">Enum's Fields and Methods</h3>
<p>Each constant of an enum type is actually an instance of the enum class and is a field in the enum class declared with <code class="codehilite">public static final</code>.<br />
Since enum in Java is a class, we can define constructors, methods, and fields in enums.  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">enum</span> <span class="n">Color</span> <span class="o">{</span>
  <span class="n">BLACK</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span>
  <span class="n">WHITE</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span>
  <span class="n">RED</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span>
  <span class="n">BLUE</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">),</span>
  <span class="n">GREEN</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span>
  <span class="n">YELLOW</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">),</span>
  <span class="n">PURPLE</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">r</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">g</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">b</span><span class="o">;</span>

  <span class="n">Color</span><span class="o">(</span><span class="kt">double</span> <span class="n">r</span><span class="o">,</span> <span class="kt">double</span> <span class="n">g</span><span class="o">,</span> <span class="kt">double</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">luminance</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="mf">0.2126</span> <span class="o">*</span> <span class="n">r</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.7152</span> <span class="o">*</span> <span class="n">g</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="mf">0.0722</span> <span class="o">*</span> <span class="n">b</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="n">r</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">g</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>In the example above, we represent a color with its RGB component.  Enum values should only constants, so <code class="codehilite">r</code>, <code class="codehilite">g</code>, <code class="codehilite">b</code> are declared as <code class="codehilite">final</code>.  We have a method that computes the luminance (the "brightness") of a color, and a <code class="codehilite">toString()</code> method.  </p>
<p>The enum values are now written as <code class="codehilite">BLACK(0, 0, 0)</code>, with arguments passed into its constructor.</p>
<h3 id="custom-methods-for-each-enum">Custom Methods for Each Enum</h3>
<p>Enum in Java is more powerful than the above -- we can define custom methods for each of the enum constant, by writing <em>constant-specific class body</em>.  If we do this, then each constant becomes an anonymous class that extends the enclosing enum.   </p>
<p>Consider the enum <code class="codehilite">EventType</code>.  You can do the following:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">enum</span> <span class="n">EventType</span> <span class="o">{</span>
  <span class="n">CUSTOMER_ARRIVE</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="kt">double</span> <span class="n">time</span><span class="o">,</span> <span class="n">Customer</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">time</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&quot; arrives&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">CUSTOMER_DONE</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="kt">double</span> <span class="n">time</span><span class="o">,</span> <span class="n">Customer</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">time</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&quot; done&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">};</span>

  <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="kt">double</span> <span class="n">time</span><span class="o">,</span> <span class="n">Customer</span> <span class="n">c</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>In the code above, <code class="codehilite">EventType</code> is an abstract class -- <code class="codehilite">log</code> is defined as <code class="codehilite">abstract</code> with no implementation.  Each enum constant has its own implementation to log that particular event.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">EventType</span><span class="o">.</span><span class="na">CUSTOMER_DONE</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">time</span><span class="o">,</span> <span class="n">customer</span><span class="o">)</span>
</pre></div>
</td></tr></table>

<p>to log that particular event.</p>
<p>I admit that this example is rather contrived -- we can do the same with a polymorphism in a much cleaner way.</p>
<h3 id="the-class-enum">The Class <code class="codehilite">Enum</code></h3>
<p><code class="codehilite"><span class="k">enum</span></code> is a special type of class in Java.  All <code class="codehilite"><span class="k">enum</span></code> inherits from the class <code class="codehilite">Enum</code> implicitly.  Since <code class="codehilite"><span class="k">enum</span></code> is a class, we can extend <code class="codehilite"><span class="k">enum</span></code> from interfaces as per normal class.  Unfortunately, <code class="codehilite"><span class="k">enum</span></code> cannot extend another class, since it already extends from <code class="codehilite">Enum</code>.</p>
<p>One implicitly declared method in <code class="codehilite"><span class="k">enum</span></code> is a static method:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">E</span><span class="o">[]</span> <span class="nf">values</span><span class="o">();</span>
</pre></div>
</td></tr></table>

<p>We can call <code class="codehilite">EventType.values()</code> or <code class="codehilite">Color.values()</code> to return an array  of event types or an array of colors.  <code class="codehilite">E</code> is a type parameter, corresponding to the enum type (either <code class="codehilite">EventType</code>, <code class="codehilite">Color</code>, etc).  To maintain flexibility and type safety, the class <code class="codehilite">Enum</code> which all enums inherit from has to be a generic class with <code class="codehilite">E</code> as a type parameter.</p>
<p>Considering <code class="codehilite">EventType</code>,
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">enum</span> <span class="n">EventType</span> <span class="o">{</span>
  <span class="n">CUSTOMER_ARRIVE</span><span class="o">,</span> 
  <span class="n">CUSTOMER_DONE</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></p>
<p>is actually 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EventType</span> <span class="kd">extends</span> <span class="n">Enum</span><span class="o">&lt;</span><span class="n">EventType</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">EventType</span><span class="o">[]</span> <span class="n">values</span> <span class="o">{</span> <span class="o">..</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">EventType</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="o">..</span> <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">EventType</span> <span class="n">CUSTOMER_ARRIVE</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">EventType</span> <span class="n">CUSTOMER_DONE</span><span class="o">;</span>
    <span class="o">:</span>

  <span class="kd">static</span> <span class="o">{</span>
    <span class="n">CUSTOMER_ARRIVE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EventType</span><span class="o">();</span>
    <span class="n">CUSTOMER_DONE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EventType</span><span class="o">();</span>
      <span class="o">:</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></p>
<p>Even though we can't extend from <code class="codehilite">Enum</code> directly, Java wants to ensure that <code class="codehilite">E</code> must be a subclass of <code class="codehilite">Enum</code> (so that we can't do something non-sensical like <code class="codehilite">Enum&lt;String&gt;</code>.  Furthermore, some methods from <code class="codehilite">Enum</code> (such as <code class="codehilite">compareTo()</code>) are inherited to the enum class, and these methods involved generic type <code class="codehilite">E</code>.  To ensure that the generic type <code class="codehilite">E</code> actually inherits from <code class="codehilite">Enum&lt;E&gt;</code>, Java defines the class <code class="codehilite">Enum</code> to have bounded generic type <code class="codehilite">Enum&lt;E extends Enum&lt;E&gt;&gt;</code>.</p>
<p>The expansion of enum <code class="codehilite">EventType</code> to a class above also illustrates a few points:</p>
<ul>
<li>An <code class="codehilite"><span class="k">enum</span></code> is final.  We cannot inherit from enum (those with constant-specific body are exceptions).</li>
<li>A class in Java can contain fields of the same class.</li>
<li>The block marked by <code class="codehilite">static { .. }</code> are <em>static initializers</em>, they are called when the class is first used.  They are the counterpart to constructors for objects, and are useful for non-trivial initialization of static fields in a class.</li>
</ul>
<h3 id="enum-related-collections">Enum-related Collections</h3>
<p>Java Collection Frameworks provide two useful classes <code class="codehilite">EnumSet</code> and <code class="codehilite">EnumMap</code> -- they can be viewed as special cases of <code class="codehilite">HashSet</code> and <code class="codehilite">HashMap</code> respectively -- the only difference is that we can only put enum values into <code class="codehilite">EnumSet</code> and enum-type keys into <code class="codehilite">EnumMap</code>. </p>
<h3 id="exercise">Exercise</h3>
<ol>
<li>
<p>Explain how each of the following language features of Java ensures type safety. You can give an example.</p>
<p>(a) enum
(b) generics</p>
</li>
<li>
<p>Consider the program below:</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">f</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="n">A</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Suppose that a variable <code class="codehilite">b</code> is an instance of class <code class="codehilite">B</code>, and a program calls <code class="codehilite">b.f()</code>. Sketch the content of the stack and heap immediately after the Line <code class="codehilite">A a = new A()</code> is executed. Label the values and variables / fields clearly. You can assume b is already on the heap and you can ignore all other content of the stack and the heap before <code class="codehilite">b.f()</code> is called.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lec05/index.html" title="5. Generics and Collections" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                5. Generics and Collections
              </span>
            </div>
          </a>
        
        
          <a href="../lec07/index.html" title="7. Functions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                7. Functions
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Wei Tsang Ooi, Department of Computer Science, National University of Singapore 2018
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ed2cc613.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>