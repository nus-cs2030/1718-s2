
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://nus-cs2030.github.io/1718-s2/lec09/index.html">
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>9. FP Patterns - CS2030 Programming Methodology II</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://nus-cs2030.github.io/1718-s2" title="CS2030 Programming Methodology II" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Lectures
                </span>
              
            
            9. FP Patterns
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/nus-cs2030/1718-s2" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    CS2030 Programming Methodology II
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/nus-cs2030/1718-s2" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      General
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/index.html" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prereqs/index.html" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../policies/index.html" title="Policies" class="md-nav__link">
      Policies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../schedule/index.html" title="Schedule" class="md-nav__link">
      Schedule
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../readings/index.html" title="Readings" class="md-nav__link">
      Readings
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../final/index.html" title="Final" class="md-nav__link">
      Final
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../midterm/index.html" title="Midterm" class="md-nav__link">
      Midterm
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lab0/index.html" title="0. Warm Up" class="md-nav__link">
      0. Warm Up
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1a/index.html" title="1a. Simulator v1.0" class="md-nav__link">
      1a. Simulator v1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab1b/index.html" title="1b. Simulator v1.1" class="md-nav__link">
      1b. Simulator v1.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2a/index.html" title="2a. Simulator v1.2" class="md-nav__link">
      2a. Simulator v1.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab2b/index.html" title="2b. Simulator v1.3" class="md-nav__link">
      2b. Simulator v1.3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab3/index.html" title="3.  Infinite List" class="md-nav__link">
      3.  Infinite List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab4a/index.html" title="4a. Simulator v2.0" class="md-nav__link">
      4a. Simulator v2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab4b/index.html" title="4b. Simulator v2.1" class="md-nav__link">
      4b. Simulator v2.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab5/index.html" title="5.  Matrix Multiplication" class="md-nav__link">
      5.  Matrix Multiplication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab6/index.html" title="6.  Async Web API" class="md-nav__link">
      6.  Async Web API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Lectures
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Lectures
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lec01/index.html" title="1. Abstraction & Encapsulation" class="md-nav__link">
      1. Abstraction & Encapsulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec02/index.html" title="2. Interface, Inheritance & Polymorphism" class="md-nav__link">
      2. Interface, Inheritance & Polymorphism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec03/index.html" title="3. More on Inheritance" class="md-nav__link">
      3. More on Inheritance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec04/index.html" title="4. Types, Memory, Exception" class="md-nav__link">
      4. Types, Memory, Exception
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec05/index.html" title="5. Generics and Collections" class="md-nav__link">
      5. Generics and Collections
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec06/index.html" title="6. hashCode, Nested Class, enum" class="md-nav__link">
      6. hashCode, Nested Class, enum
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec07/index.html" title="7. Functions" class="md-nav__link">
      7. Functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec08/index.html" title="8. Streams" class="md-nav__link">
      8. Streams
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        9. FP Patterns
      </label>
    
    <a href="index.html" title="9. FP Patterns" class="md-nav__link md-nav__link--active">
      9. FP Patterns
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" title="Learning Objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-interface" title="Functional Interface" class="md-nav__link">
    Functional Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functor" title="Functor" class="md-nav__link">
    Functor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functor-laws" title="Functor Laws" class="md-nav__link">
    Functor Laws
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monad" title="Monad" class="md-nav__link">
    Monad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monad-laws" title="Monad Laws" class="md-nav__link">
    Monad Laws
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-strategy-or-policy" title="Implementing Strategy or Policy" class="md-nav__link">
    Implementing Strategy or Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observer-pattern" title="Observer Pattern" class="md-nav__link">
    Observer Pattern
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" title="Exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec10/index.html" title="10. Parallel streams" class="md-nav__link">
      10. Parallel streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lec11/index.html" title="11. Asynchronous" class="md-nav__link">
      11. Asynchronous
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../style/index.html" title="Coding Style" class="md-nav__link">
      Coding Style
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Software/Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Software/Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../jdk/index.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../javadoc/index.html" title="Javadoc" class="md-nav__link">
      Javadoc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unix/index.html" title="UNIX" class="md-nav__link">
      UNIX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim/index.html" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" title="Learning Objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functional-interface" title="Functional Interface" class="md-nav__link">
    Functional Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functor" title="Functor" class="md-nav__link">
    Functor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functor-laws" title="Functor Laws" class="md-nav__link">
    Functor Laws
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monad" title="Monad" class="md-nav__link">
    Monad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monad-laws" title="Monad Laws" class="md-nav__link">
    Monad Laws
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementing-strategy-or-policy" title="Implementing Strategy or Policy" class="md-nav__link">
    Implementing Strategy or Policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observer-pattern" title="Observer Pattern" class="md-nav__link">
    Observer Pattern
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" title="Exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nus-cs2030/1718-s2/edit/master/docs/lec09.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="lecture-9-functional-style-programming-patterns">Lecture 9: Functional-Style Programming Patterns</h1>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>After this lecture, students should:</p>
<ul>
<li>Understand what is a SAM and how to write own's functional interface that can be represented by a lambda expression</li>
<li>Understand what are functors and monads in the context of Java's <code class="codehilite">Stream</code>, <code class="codehilite">Optional</code></li>
<li>Understand the laws that a functor and monad must obey and be able to verify them</li>
<li>Aware of different programming patterns using lambda, including functor, monad, polymorphism, and observer.</li>
</ul>
<h2 id="functional-interface">Functional Interface</h2>
<p>We have seen how we can write lambda expressions of types <code class="codehilite">Function</code>, <code class="codehilite">Predicate</code>, <code class="codehilite">Supplier</code>, <code class="codehilite">Consumer</code>, and <code class="codehilite">BiFunction</code>.  We, however, are not limited the types defined in <code class="codehilite">java.util.function</code>.  We can use a lambda expression as a short hand to an anonymous class that implements any interface with <em>a single abstract method</em>.   The reason there has to be only one abstract method is so that the compiler can infer which method body the lambda expression implements.  Such an interface is more commonly known as a <em>SAM interface</em>.  </p>
<p>A SAM interface can contain multiple methods, but only one needs to be abstract, others can contain <code class="codehilite">default</code> implementations.</p>
<p>For instance, Java has the following interface:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">Runnable</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">run</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></p>
<p>There is only one method, and it is abstract (no default implementation).  So it is a valid SAM interface.</p>
<p>We can write:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;hello world&quot;</span><span class="o">);</span> <span class="o">}</span>
</pre></div>
</td></tr></table>

<p>We can annotate a class with <code class="codehilite">@FunctionalInterface</code> to hint our intention to the compiler and to let the compiler helps us catch any unintended error, such as when we add a second abstract method to the interface.</p>
<p>We can define our own functional interfaces as well.  For instance, we can define:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nd">@FunctionalInterface</span>
<span class="kd">interface</span> <span class="nc">FindServerStrategy</span> <span class="o">{</span>
  <span class="n">Server</span> <span class="nf">findQueue</span><span class="o">(</span><span class="n">Shop</span> <span class="n">shop</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">FindServerStrategy</span> <span class="n">greedy</span> <span class="o">=</span> <span class="n">shop</span> <span class="o">-&gt;</span> <span class="n">shop</span><span class="o">.</span><span class="na">getShortestQueue</span><span class="o">();</span>
<span class="n">FindServerStrategy</span> <span class="n">typical</span> <span class="o">=</span> <span class="n">shop</span> <span class="o">-&gt;</span> <span class="n">shop</span><span class="o">.</span><span class="na">getFirstAvailableQueue</span><span class="o">();</span>
</pre></div>
</td></tr></table></p>
<p>While the interface above can be represented with a <code class="codehilite">Function&lt;Shop,Server&gt;</code>, one might find it easier to read 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>greedy.findQueue(shop)
</pre></div>
</td></tr></table></p>
<p>as opposed to:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>greedy.apply(shop)
</pre></div>
</td></tr></table></p>
<h2 id="functor">Functor</h2>
<p>In this lecture, we are going to abstract out some useful patterns that we have seen so far in functional-style programming in Java, and relates it to concepts in functional programming.<br />
Once you see and understand the patterns, hopefully you can reapply the patterns in other context.</p>
<p>Let's start with a simple one, called <em>functor</em>.  This funny name originated from a branch of mathematics, called category theory.  We can think of a functor as something that takes in a function and returns another functor.  We can think of it the interface below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">Functor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">Functor</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">func</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>A functor can be any class that implements the interface above, or matches the pattern above.</p>
<p>Let's took at the example below:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">A</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">A</span> <span class="nf">f</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">func</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">A</span><span class="o">(</span><span class="n">func</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">x</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">A</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSameAs</span><span class="o">(</span><span class="n">A</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> 
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>The class <code class="codehilite">A</code> above takes in a function and returns another <code class="codehilite">A</code> with <code class="codehilite">func</code> applied on the content <code class="codehilite">x</code>, if <code class="codehilite">x</code> is positive.  Otherwise, it returns another <code class="codehilite">A</code> with 0.  </p>
<p>Despite that it does not implement the interface <code class="codehilite">Functor</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>, it does match the pattern of having a method that takes in a function and returns itself, it is a special case since both <code class="codehilite">R</code> and <code class="codehilite">T</code> are <code class="codehilite">Integer</code>.</p>
<h3 id="functor-laws">Functor Laws</h3>
<p>Matching the patterns syntactically, however, is not enough to be a functor.  A functor has to semantically obey the functor laws, which are:</p>
<ul>
<li>if <code class="codehilite">func</code> is an identity function <code class="codehilite">x -&gt; x</code>, then it should not change the functor.</li>
<li>if <code class="codehilite">func</code> is a composition of two functions <span>\(g \cdot h\)</span>, then the resulting functor should be the same as calling <code class="codehilite">f</code> with <span>\(h\)</span> and then with <span>\(g\)</span>.</li>
</ul>
<p>Let's check: 
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>A a = new A(-1);
a.isSameAs(a.f(x -&gt; x));
a.f(x -&gt; x + 1).f(x -&gt; x * 2).isSameAs(a.f(x -&gt; (x + 1) * 2));
</pre></div>
</td></tr></table></p>
<p>The second line above failed to return true.  As such, class <code class="codehilite">A</code> violates the first functor law and therefore is not a functor.  Class <code class="codehilite">B</code> below, however, is a functor:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">B</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">B</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">B</span> <span class="nf">f</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">func</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">B</span><span class="o">(</span><span class="n">func</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">x</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSameAs</span><span class="o">(</span><span class="n">B</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="na">x</span><span class="o">;</span> 
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>It is easy to see that if <code class="codehilite">func</code> is <code class="codehilite">x -&gt; x</code>, then <code class="codehilite">B(func.apply(x))</code> is just <code class="codehilite">B(x)</code>.  Further, if <code class="codehilite">func</code> is <code class="codehilite">g.compose(h)</code>, then calling <code class="codehilite">func.apply(x)</code> is the same as <code class="codehilite">g.apply(h.apply(x))</code>.</p>
<p>Another way to think of a functor, in the OO-way, is that that it is <em>a variable wrapped within a class in some context</em>.  Instead of manipulating the variable directly, we pass in a function to the class to manipulate the variable.  The variable must then interact with the function as if it is not be wrapped, and the class should not interfere with the function (as in the class <code class="codehilite">A</code>).  In other words, we use lambda expression for <em>cross-abstraction barrier manipulation</em>.</p>
<p>You have actually seen several functors before.  You might recognize by now that <code class="codehilite">f</code> is just our old friend <code class="codehilite">map</code>.  <code class="codehilite">LambdaList</code> (from Lecture 7), <code class="codehilite">InfiniteList</code> (from Lab 4), and <code class="codehilite">Stream</code> (from <code class="codehilite">java.util.stream</code>) are functors wrap around a (possibly infinite) list of items.</p>
<div class="admonition note">
<p class="admonition-title">Functors in other languages</p>
<p>Haskell, Scala, Python, Javascript, and other functional languages have functors as well.  C++, unfortunately, uses the term functors to mean function object -- a function object is not a functor in the sense of the word in category theory.  So, do not get confused between the two.</p>
</div>
<p>Once you understand the laws of functor and recognize this pattern, it is easy to learn about new classes -- one just have to tell you that it is a functor, and you will know how the class should behave.  For instance, I can tell you that <code class="codehilite">Optional</code> is a functor.  Do you know what method <code class="codehilite">Optional</code> supports and how it behave?</p>
<p>Recall that you can wrapped a possibly <code class="codehilite">null</code> object in an <code class="codehilite">Optional</code> class.  We can manipulate the value[^2] wrapped in an <code class="codehilite">Optional</code> with the <code class="codehilite">map</code> function.  The <code class="codehilite">map</code> method applies the given method only if the value is present, preventing us from writing a if-not-null check and the danger of <code class="codehilite">NullPointerException</code> if we forget to check.</p>
<div class="admonition note">
<p class="admonition-title">Issues with Java <code class="codehilite">Optional</code></p>
<p>Java's <code class="codehilite">Optional</code> is not very well-designed.  It is unfortunate that Java 8 provides a <code class="codehilite">get()</code> method to allow retrieval of the object inside the functor, with the possibility of causing a run-time exception if <code class="codehilite">Optional</code> is empty.  The whole point of using <code class="codehilite">Optional</code> is to be safe from run-time exception!  Not to mentioned that Java Collections Framework does not support <code class="codehilite">Optional</code>.  </p>
</div>
<h2 id="monad">Monad</h2>
<p>A monad also takes in a function and returns a monad.  But, unlike functor, it takes in a function that returns a monad.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">Monad</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">Monad</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">f</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">Monad</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;&gt;</span> <span class="n">func</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>The pattern above might look complicated, but you have actually seen it before:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">interface</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="nf">flatMap</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;&gt;</span> <span class="n">mapper</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>This interface should look familiar to you<sup id="fnref:3"><a class="footnote-ref" href="#fn:3" rel="footnote">2</a></sup>.  We have seen monads before -- <code class="codehilite">Stream</code> is a monad.  In contrast, unless you implemented <code class="codehilite">flatMap</code> for <code class="codehilite">InfiniteList</code> or <code class="codehilite">LambdaList</code>, they are not monads.</p>
<h3 id="monad-laws">Monad Laws</h3>
<p>Just like functors, there are some laws that a monad have to follow:</p>
<ul>
<li>
<p>there should be an <code class="codehilite">of</code> operation that takes an object (or multiple objects) and wrap it/them into a monad.  Further, </p>
<ul>
<li><code class="codehilite">Monad.of(x).flatMap(f)</code> should be equal to <code class="codehilite">f(x)</code>  (called the <em>left identity</em> law)</li>
<li><code class="codehilite">monad.flatMap(x -&gt; Monad.of(x))</code> should be equal to <code class="codehilite">monad</code> (called the <em>right identity</em> law)</li>
</ul>
</li>
<li>
<p>the <code class="codehilite">flatMap</code> operation should be associative (associative law):
<code class="codehilite">monad.flatMap(f).flatMap(g)</code> should be equal to <code class="codehilite">monad.flatMap(x -&gt; f(x).flatMap(g))</code></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">In other languages</p>
<p>The <code class="codehilite">flatMap</code> and <code class="codehilite">of</code> operations are sometimes known as the <code class="codehilite">bind</code> and <code class="codehilite">unit</code> operations respectively (e.g., in Haskell).</p>
</div>
<p>Knowing what is a monad is useful, since if I tell you something is a monad, you should recognize that it supports a given interface.  For instance, I tell you that <code class="codehilite">Optional</code> is a monad.  You should know that <code class="codehilite">Optional</code> supports the <code class="codehilite">of</code> and <code class="codehilite">flatMap</code> operation.   The name of the operations may be different, but they must exists in a monad and follows the monad laws.</p>
<p>We won't proof formally that <code class="codehilite">Optional</code> follows the laws of monad in this class, but let's explore a bit more to convince ourselves that it does.  Let's write the <code class="codehilite">flatMap</code> method for <code class="codehilite">Optional</code>, which is not that difficult:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="nf">flatMap</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">,</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span> <span class="n">mapper</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">isPresent</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">empty</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Let check:</p>
<ul>
<li>Left identity law: <code class="codehilite">Optional.of(x).flatMap(f)</code> will return <code class="codehilite">f.apply(x)</code> (i.e., <span>\(f(1)\)</span>).</li>
<li>Right identity law: <code class="codehilite">opt.flatMap(x -&gt; Optional.of(x)</code> will apply <code class="codehilite">x -&gt; Optional.of(x)</code> on the value of <code class="codehilite">opt</code>, if it exists, resulting in <code class="codehilite">Optional.of(value)</code>, which is <code class="codehilite">opt</code>. If the value does not exist (<code class="codehilite">Optional</code> is empty), then <code class="codehilite">flatMap</code> will not apply the lambda, instead it will return <code class="codehilite">empty()</code> right away.  So it obeys the law.</li>
<li>Associative law: <code class="codehilite">opt.flatMap(f).flatMap(g)</code> is the same as <code class="codehilite">f.apply(value).flatMap(g)</code>; <code class="codehilite">opt.flatMap(x -&gt; f(x).flatMap(g))</code> will apply the lambda to <code class="codehilite">value</code>, so we get <code class="codehilite">f.apply(value).flatMap(g)</code>.  They are the same.  If <code class="codehilite">opt</code> is empty, then <code class="codehilite">flatMap</code> returns <code class="codehilite">empty</code> for both cases.</li>
</ul>
<p>So, despite the complicated-sounding laws, they are actually easy to verify.</p>
<h2 id="implementing-strategy-or-policy">Implementing Strategy or Policy</h2>
<p>Polymorphism is one of the pillars of OO programming.  We have seen how, through inheritance and polymorphism, we can extend the behavior of a class.  In some cases, polymorphism is useful for implementing different behaviors for different subclasses.  For instance, </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="n">Server</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
  <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">needRest</span><span class="o">();</span>
  <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">available</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">HumanServer</span> <span class="kd">extends</span> <span class="n">Server</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">needRest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">available</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">say</span><span class="o">(</span><span class="s">&quot;Next, please!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MachineServer</span> <span class="kd">extends</span> <span class="n">Server</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="nf">needRest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kt">void</span> <span class="nf">available</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">turnLightGreen</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>We override the method <code class="codehilite">needRest</code> to indicate if a particular server needs to rest, and <code class="codehilite">available</code> to perform an action when the server becomes available.  This is sometimes known as the <em>strategy</em> pattern or the <em>policy</em> pattern, where each class encapsulates a different way of achiving the same thing.  </p>
<p>You may see that, since <code class="codehilite">needRest</code> only returns a constant, one could easily store that in a field.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="n">needRest</span><span class="o">;</span>

  <span class="n">Server</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">needRest</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">needRest</span> <span class="o">=</span> <span class="n">needRest</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kt">boolean</span> <span class="nf">needRest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">needRest</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">available</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">HumanServer</span> <span class="kd">extends</span> <span class="n">Server</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">available</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">say</span><span class="o">(</span><span class="s">&quot;Next, please!&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">MachineServer</span> <span class="kd">extends</span> <span class="n">Server</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">available</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">turnLightGreen</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>What about the strategy?  With lambda expressions, it turns out that we can store the body of the method in a field as well.  The <code class="codehilite">available</code> method takes in no argument and returns nothing, so the functional interface <code class="codehilite">Runnable</code> is perfect for this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
  <span class="kt">boolean</span> <span class="n">needRest</span><span class="o">;</span>
  <span class="n">Runnable</span> <span class="n">availableAction</span><span class="o">;</span>

  <span class="n">Server</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">needRest</span><span class="o">,</span> <span class="n">Runnable</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">needRest</span> <span class="o">=</span> <span class="n">needRest</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">availableAction</span> <span class="o">=</span> <span class="n">action</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kt">boolean</span> <span class="nf">needRest</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">needRest</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">available</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">availableAction</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>We have removed two subclasses.  Instead of:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HumanServer</span><span class="o">();</span>
<span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MachineServer</span><span class="o">();</span>
</pre></div>
</td></tr></table>

<p>we can do</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span>  <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">say</span><span class="o">(</span><span class="s">&quot;Next, please!&quot;</span><span class="o">));</span> 
<span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">turnLightGreen</span><span class="o">());</span>
</pre></div>
</td></tr></table>

<p>Such style of code makes the intention more explicit (no need to trace through different class files to understand the behavior), but exposes some implementation details.  In terms of extensibility, it is easier, since we no longer need to create subclasses to add a new type of behavior.  For example, we can say:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">new</span> <span class="n">Server</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">announceNextQueueNumber</span><span class="o">());</span>
</pre></div>
</td></tr></table>

<p>Either of these style (OOP or FP) is better than having to write switch statements or if-then-else statements if we code in imperative style.</p>
<h2 id="observer-pattern">Observer Pattern</h2>
<p>Often, in our code, an event can trigger a series of actions.  For instance, pressing a button on the GUI could trigger an update to the user interface, a sound to be played, an action to be performed, etc.  While one could hardcode these responses to a trigger, it would be nicer if one could add a customer action in response to a trigger.  For instance, we might want to say, log an entry into a file when the button is pressed.</p>
<p>In OO design, this is known as the Observer pattern.  With lambda, we can implement something like this with a list of lambda expressions:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">class</span> <span class="nx">Event</span> <span class="p">{</span>
  <span class="nx">List</span><span class="o">&lt;</span><span class="nx">Runnable</span><span class="o">&gt;</span> <span class="nx">actions</span><span class="p">;</span>

    <span class="nx">Event() {</span>
        <span class="nx">actions</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="k">void</span> <span class="nx">register</span><span class="p">(</span><span class="nx">Runnable</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">void</span> <span class="nx">trigger() {</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">Runnable</span> <span class="nx">r</span>: <span class="kt">actions</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>This allows us to cleanly separate the different <em>concerns</em>.  In the button example, which is a GUI component, we no longer need to mixed code dealing with sounds, logging, nor application-specific actions.  Each of these can be implemented in a different packages, and only need to register their code to the list of actions to perform when the button is pressed.</p>
<h2 id="exercise">Exercise</h2>
<ol>
<li>
<p>The interface <code class="codehilite">SummaryStrategy</code> has a single abstract method <code class="codehilite">summarize</code>, allowing any implementing class to define its own strategy of summarizing a long <code class="codehilite">String</code> to within the length of a given <code class="codehilite">lengthLimit</code>.  The declaration of the interface is as follows: </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nd">@FunctionalInterface</span>
<span class="kd">interface</span> <span class="nc">SummaryStrategy</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">summarize</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">,</span> <span class="kt">int</span> <span class="n">lengthLimit</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>There is another method <code class="codehilite">createSnippet</code> that takes in a <code class="codehilite">SummaryStrategy</code> object as an argument.  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">createSnippet</span><span class="o">(</span><span class="n">SummaryStrategy</span> <span class="n">strategy</span><span class="o">)</span> <span class="o">{</span> 
    <span class="o">:</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

<p>Suppose that there is a class <code class="codehilite">TextShortener</code> with a static method <code class="codehilite">String shorten(String s, int n)</code> that shortens the String <code class="codehilite">s</code> to within the length of <code class="codehilite">n</code>.  This method can serve as a summary strategy, and you want to use <code class="codehilite">shorten</code> as a <code class="codehilite">SummaryStrategy</code> in the method <code class="codehilite">createSnippet</code>.  </p>
<p>Show how you would call <code class="codehilite">createSnippet</code> with the static method <code class="codehilite">shorten</code> from the class <code class="codehilite">TextShortener</code> as the strategy.</p>
</li>
<li>
<p>Suppose we have a snippet of code as follows, </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Double d = foo(i);
String s = bar(d);
</pre></div>
</td></tr></table>

<p>We can write it either as:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>stream.map(i -&gt; foo(i)).map(d -&gt; bar(d));
</pre></div>
</td></tr></table>

<p>or </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>stream.map(i -&gt; bar(foo(i)))
</pre></div>
</td></tr></table>

<p>We can be assured that the expressions above are the same because a stream is a functor.  Why?  Explain by indicating which law ensures the behavior above is true.</p>
</li>
</ol>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>In fact, no functors in Java 8 does, since this is the interface I created just to explain the pattern of a functor.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>Just a reminder again that these are not real interfaces in Java but just something to show you the types of input/output to a monad in a language that you are familiar with.&#160;<a class="footnote-backref" href="#fnref:3" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lec08/index.html" title="8. Streams" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                8. Streams
              </span>
            </div>
          </a>
        
        
          <a href="../lec10/index.html" title="10. Parallel streams" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                10. Parallel streams
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Wei Tsang Ooi, Department of Computer Science, National University of Singapore 2018
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>